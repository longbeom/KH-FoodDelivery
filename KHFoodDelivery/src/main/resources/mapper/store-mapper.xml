<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="store">

	<!-- 입점 신청 승인 -->
	<update id="updateStoreConfirm" parameterType="_int">
		UPDATE STORE SET isConfirm = 1 WHERE businessCode = #{no}
	</update>
	
	<!-- 입점 신청 리스트 -->
	<select id="selectAppStoreList" resultType="store">
		SELECT * FROM STORE ORDER BY appDate DESC
	</select>
	
	<!-- 입점 신청 store 모달 띄우기 -->
	<select id="selectAppStore" resultType="store" parameterType="_int">
		SELECT * FROM STORE WHERE businessCode = #{no}
	</select>
	
	<!-- 입점 신청 Count -->
	<select id="selectAppStoreCount" resultType="_int">
		SELECT COUNT(*) FROM STORE WHERE isConfirm = 0
	</select>
	
	<!-- 전체 입점 리스트 -->
	<select id="selectStoreList" resultType="store">
		SELECT * FROM STORE WHERE isConfirm = 1
	</select>
	<!-- 전체 입점 리스트2 -->
	<select id="selectStoreListTwo" parameterType="string" resultType="store">
		SELECT * FROM STORE WHERE ownerId=#{ownerId}
	</select>
	<!-- 전체 입점 Count -->
	<select id="selectStoreCount" resultType="_int">
		SELECT COUNT(*) FROM STORE WHERE isConfirm = 1
	</select>
	
	<!-- 입점 검색 -->
	<select id="selectSearchStore" resultType="store">
		SELECT 
			*
		FROM 
			STORE
		WHERE
			isConfirm = 1
		AND
			(storeName LIKE '%'||#{keyword}||'%' OR storeAddress LIKE '%'||#{keyword}||'%')		<!-- OR 문 때문에 () 필수 -->
		AND
			<choose>
				<when test="category eq '전체'">
					1 = 1
				</when>
				<otherwise>
					storeCategory = #{category}
				</otherwise>
			</choose>
		ORDER BY
			appDate DESC
	</select>
	
	<!-- 입점 검색 Count -->
	<select id="selectSearchStoreCount" resultType="_int">
		SELECT 
			COUNT(*) 
		FROM 
			STORE 
		WHERE
			isConfirm = 1
		AND
			(storeName LIKE '%'||#{keyword}||'%' OR storeAddress LIKE '%'||#{keyword}||'%')
		AND
			<choose>
				<when test="category eq '전체'">
					1 = 1
				</when>
				<otherwise>
					storeCategory = #{category}
				</otherwise>
			</choose>
	</select>
	
	<insert id="addStore" parameterType="map">
		INSERT INTO STORE VALUES(SEQ_BUSINESSCODE.NEXTVAL, #{ownerId}, #{businessName}, #{businessPhone}, #{storeName}, #{storePhone}, #{storeAddress}, #{storeCategory}, #{reName}, #{minPrice}, #{storeProfile}, DEFAULT, SYSDATE, #{businessNum}, 5, 5)
	</insert>
		
	<!-- resultMap : Store -->
	<resultMap type="map" id="store"></resultMap>
	
</mapper>
